@using Bibliotheque.Models
@using Bibliotheque.ViewModels
@model BibliothequeViewModel

@{
    var obj = Session["User"] as User;

    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Main</title>

    <table>
        <tr>
            <th>Name</th>
            <th>Mail</th>
        </tr>
        <tr>
            <td>@obj.Name</td>
            <td>@obj.Email</td>
        </tr>
    </table>

</head>

@{
    List<SelectListItem> CategoriesList = new List<SelectListItem>();

    foreach (Category c in Model.CatsVM.Categories)
    {
        CategoriesList.Add(new SelectListItem { Text = c.Title, Value = c.IdCategory.ToString()});
    }

}

<div>
    @Html.DropDownListFor(m => m.CatsVM.Categories,
        CategoriesList.OrderBy(k => k.Text), htmlAttributes: new { @id = "dropdown" })
</div>

<div>

    <input type="text" id="textbox"/>
    <input type = "submit"
           id="submit"
           name = "submit"
           value = "Search"/>

</div>

<body>

<div id="element_list_container">

</div>

    <div>
        <button onclick="location.href = '@Url.Action("Create", "Categories")';return false;">Add a Category</button>
    </div>

    <div>
        <button onclick="location.href = '@Url.Action("Disconnect", "Home")';return false;">Log out</button>
    </div>

</body>
</html>
 
<script src="~/Scripts/jquery-3.4.1.js"></script>
<script src="~/Scripts/jquery-3.4.1.min.js"></script>

<script>
 //Script en ajax pour modifier dynamiquement l'affichage

    $('#submit').click(function (e) {

        $.ajax({
            type: "POST",
            url: "../Elements/Search",
            data: { search: $("#textbox").val(), id: $("#dropdown option:selected").val() },
            success: function (data) { $("#element_list_container").html(data); },
            error: function () { alert("Something went wrong in controller."); }
        });
    });

    $('#dropdown').ready(function (e) {

        var row_num = $("#dropdown option:selected").val();

        $.ajax({
            type: "GET",
            url: "../Elements/List",
            data: { id: row_num },
            success: function (data) {
                $("#element_list_container").html(data);
            },

            error: function () { alert("Something went wrong in controller."); }

        });

    });

    $('#dropdown').change(function (e) {

        var row_num = $("#dropdown option:selected").val();

        $.ajax({
            type: "GET",
            url: "../Elements/List",
            data: { id: row_num },
            success: function(data) {
                $("#element_list_container").html(data);
                $("#textbox").val("");
            },

            error: function () { alert("Something went wrong in controller."); }

        });

    });

</script>
